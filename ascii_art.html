<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ASCII Art Generator</title>
<style>
    body {
        background-color: #111;
        color: #fff;
        font-family: Menlo, "Courier New", Courier, monospace;
        text-align: center;
        padding: 20px;
    }
    #ascii-output {
        white-space: pre;
        font-size: 8px;
        display: inline-block;
        text-align: left;
        margin-top: 20px;
        max-width: 90%;
        overflow-x: auto;
    }
    .setting {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 8px 0;
    }
    .setting label {
        width: 150px; /* larghezza fissa per allineamento */
        text-align: right;
        margin-right: 10px;
    }
    input, select, button {
        padding: 5px;
        font-size: 14px;
    }
    button {
        margin-top: 10px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>ASCII Art Generator</h1>

<div class="setting">
    <label for="imgInput">Seleziona immagine:</label>
    <input type="file" id="imgInput" accept="image/*">
</div>

<div class="setting">
    <label for="scaleSelect">Fattore di scala:</label>
    <select id="scaleSelect">
      <option value="0.05">0.05</option>
      <option value="0.1">0.1</option>
      <option value="0.15" selected>0.15</option>
      <option value="0.2">0.2</option>
      <option value="0.3">0.3</option>
    </select>
</div>

<div class="setting">
    <label for="shadeSelect">Tipo di shade:</label>
    <select id="shadeSelect">
      <option value="$%/(;,." selected>Default</option>
      <option value="@#W&$%*o!;:.">Denso</option>
      <option value=" .:-=+*#%@">Chiaro-Scuro</option>
    </select>
</div>

<div class="setting">
    <label for="colorModeSelect">Modalità colore:</label>
    <select id="colorModeSelect">
      <option value="color" selected>Colorato</option>
      <option value="bw">Bianco e Nero</option>
    </select>
</div>

<div class="setting">
    <label for="invertBW">Inverti Bianco/Nero:</label>
    <select id="invertBW">
      <option value="no" selected>No</option>
      <option value="yes">Sì</option>
    </select>
</div>

<button id="generateBtn">Genera ASCII</button>
<button id="copyBtn">Copia ASCII</button>
<br>
<pre id="ascii-output"></pre>

<script>
let lastAsciiText = "";

document.getElementById('generateBtn').addEventListener('click', generateASCII);

document.getElementById('copyBtn').addEventListener('click', () => {
  if (!lastAsciiText) return;
  navigator.clipboard.writeText(lastAsciiText).then(() => {
    alert("ASCII art copiata negli appunti!");
  });
});

function generateASCII() {
  const file = document.getElementById('imgInput').files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      let scale = parseFloat(document.getElementById('scaleSelect').value);
      const shade = document.getElementById('shadeSelect').value;
      const colorMode = document.getElementById('colorModeSelect').value;
      const invertBW = document.getElementById('invertBW').value === "yes";

      const aspectRatioCorrection = 0.55;
      const widthCorrection = 1.0;
      let canvas = document.createElement('canvas');
      canvas.width = Math.max(1, Math.floor(img.width * scale * widthCorrection));
      canvas.height = Math.max(1, Math.floor(img.height * scale * aspectRatioCorrection));
      if (canvas.height < img.height * scale * 0.5) {
        canvas.height = Math.floor(img.height * scale * 0.5);
      }

      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      const pixels = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      let asciiHTML = "";
      let asciiText = "";

      for (let y = 0; y < canvas.height; y++) {
        let rowText = "";
        for (let x = 0; x < canvas.width; x++) {
          const idx = (y * canvas.width + x) * 4;
          const r = pixels[idx];
          const g = pixels[idx + 1];
          const b = pixels[idx + 2];

          let lum = 0.299*r + 0.587*g + 0.114*b;
          if (invertBW) lum = 255 - lum;

          const char = shade[Math.floor((lum / 255) * (shade.length - 1))];

          if (colorMode === "color") {
            asciiHTML += `<span style="color: rgb(${r},${g},${b})">${char}</span>`;
          } else {
            asciiHTML += `<span style="color:white">${char}</span>`;
          }
          rowText += char;
        }
        asciiHTML += "\n";
        asciiText += rowText + "\n";
      }

      document.getElementById('ascii-output').innerHTML = asciiHTML;
      lastAsciiText = asciiText;
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
